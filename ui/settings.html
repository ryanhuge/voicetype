<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VoiceType è¨­å®š</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  :root {
    --bg: #0a0a0b; --surface: rgba(255,255,255,0.02); --border: rgba(255,255,255,0.06);
    --text: #e8e8e8; --muted: #666; --accent: #fb923c; --accent-bg: rgba(251,146,60,0.1);
    --accent-border: rgba(251,146,60,0.4); --radius: 10px;
  }
  body {
    background: linear-gradient(160deg, #0a0a0b, #111113 40%, #0d0d0f);
    color: var(--text); font-family: 'Microsoft JhengHei', 'Segoe UI', sans-serif;
    min-height: 100vh; padding: 32px 24px;
  }
  .container { max-width: 800px; margin: 0 auto; }

  /* Header */
  .header { display: flex; align-items: center; gap: 14px; margin-bottom: 32px; }
  .logo {
    width: 42px; height: 42px; border-radius: 12px;
    background: linear-gradient(135deg, #f97316, #ea580c);
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 4px 20px rgba(249,115,22,0.3); font-size: 20px;
  }
  .header h1 { font-size: 22px; font-weight: 700; letter-spacing: -0.5px; }
  .header p { font-size: 12.5px; color: var(--muted); margin-top: 2px; }

  /* Tabs */
  .tabs {
    display: flex; gap: 4px; margin-bottom: 24px; padding: 4px;
    background: var(--surface); border: 1px solid var(--border); border-radius: 12px;
    overflow-x: auto;
  }
  .tab {
    padding: 10px 16px; border-radius: 9px; border: none; cursor: pointer;
    font-size: 13px; font-weight: 500; font-family: inherit;
    background: transparent; color: #777; transition: all 0.2s; white-space: nowrap;
  }
  .tab:hover { color: #aaa; }
  .tab.active { background: var(--accent-bg); color: var(--accent); }

  /* Card */
  .card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 16px; padding: 28px; backdrop-filter: blur(20px);
    box-shadow: 0 8px 40px rgba(0,0,0,0.3);
  }
  .card h2 { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
  .card .desc { font-size: 12.5px; color: var(--muted); margin-bottom: 24px; }

  /* Section */
  .section { margin-bottom: 24px; }
  .section-label { font-size: 13px; font-weight: 600; color: #ccc; margin-bottom: 10px; }
  .section-desc { font-size: 11.5px; color: var(--muted); margin-bottom: 10px; }

  /* Input */
  .input-group { display: flex; gap: 6px; margin-bottom: 6px; }
  .input-group label { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
  .input-group label span.badge { font-size: 11px; color: var(--accent); }

  input[type="text"], input[type="password"], textarea {
    flex: 1; padding: 10px 14px; font-size: 13px;
    background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08);
    border-radius: 8px; color: #e0e0e0; font-family: 'JetBrains Mono', monospace;
    outline: none; transition: border-color 0.2s;
  }
  input:focus, textarea:focus { border-color: rgba(251,146,60,0.5); }
  input::placeholder, textarea::placeholder { color: #444; }
  textarea { width: 100%; resize: vertical; line-height: 1.7; font-size: 12.5px; }

  /* Toggle button (show/hide) */
  .btn-icon {
    background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08);
    border-radius: 8px; color: #888; cursor: pointer; padding: 0 12px;
    display: flex; align-items: center; transition: all 0.2s; font-size: 14px;
  }
  .btn-icon:hover { background: rgba(255,255,255,0.08); color: #ccc; }

  /* Provider cards */
  .provider-card {
    display: flex; align-items: center; justify-content: space-between;
    padding: 14px 16px; border-radius: var(--radius); cursor: pointer;
    border: 1px solid var(--border); background: var(--surface);
    transition: all 0.2s; margin-bottom: 8px;
  }
  .provider-card:hover { border-color: rgba(255,255,255,0.12); }
  .provider-card.active { border-color: var(--accent-border); background: rgba(251,146,60,0.06); }
  .provider-card .name { font-size: 13.5px; font-weight: 600; color: #ccc; }
  .provider-card.active .name { color: var(--accent); }
  .provider-card .pdesc { font-size: 11.5px; color: #777; margin-top: 2px; }
  .provider-card .check { color: var(--accent); font-size: 18px; }

  /* Chips */
  .chips { display: flex; gap: 6px; flex-wrap: wrap; }
  .chip {
    padding: 7px 14px; border-radius: 8px; font-size: 12.5px; font-weight: 500;
    border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.03);
    color: #999; cursor: pointer; transition: all 0.2s; font-family: inherit;
  }
  .chip:hover { border-color: rgba(255,255,255,0.15); color: #bbb; }
  .chip.active { border-color: rgba(251,146,60,0.5); background: rgba(251,146,60,0.12); color: var(--accent); }

  /* Toggle switch */
  .toggle-row {
    display: flex; align-items: center; justify-content: space-between;
    padding: 12px 14px; border-radius: var(--radius);
    background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.05);
    margin-bottom: 10px;
  }
  .toggle-row .label { font-size: 13px; font-weight: 500; color: #ddd; }
  .toggle-row .tdesc { font-size: 11.5px; color: var(--muted); margin-top: 2px; }
  .toggle {
    width: 44px; height: 24px; border-radius: 12px; border: none; cursor: pointer;
    position: relative; transition: background 0.3s; flex-shrink: 0;
  }
  .toggle.on { background: linear-gradient(135deg, #f97316, #fb923c); }
  .toggle.off { background: rgba(255,255,255,0.1); }
  .toggle .dot {
    width: 18px; height: 18px; border-radius: 9px; background: #fff;
    position: absolute; top: 3px; transition: left 0.3s cubic-bezier(0.34,1.56,0.64,1);
    box-shadow: 0 1px 3px rgba(0,0,0,0.3);
  }
  .toggle.on .dot { left: 23px; }
  .toggle.off .dot { left: 3px; }

  /* Dictionary */
  .dict-input { display: flex; gap: 8px; margin-bottom: 16px; }
  .dict-list {
    min-height: 80px; border-radius: var(--radius);
    border: 1px solid var(--border); background: rgba(255,255,255,0.015);
    padding: 8px; display: flex; flex-wrap: wrap; gap: 6px; align-content: flex-start;
  }
  .word-tag {
    display: flex; align-items: center; gap: 6px;
    padding: 6px 10px 6px 12px; border-radius: 7px;
    background: rgba(251,146,60,0.08); border: 1px solid rgba(251,146,60,0.15);
    font-size: 12.5px; color: #e0a060;
  }
  .word-tag .remove {
    background: none; border: none; cursor: pointer; color: #996644;
    opacity: 0.6; font-size: 14px; padding: 0; line-height: 1;
  }
  .word-tag .remove:hover { opacity: 1; }
  .suggest-chips { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 12px; }
  .suggest-chip {
    padding: 5px 10px; border-radius: 6px; font-size: 11.5px;
    border: 1px dashed rgba(255,255,255,0.1); cursor: pointer;
    background: transparent; color: #888; font-family: inherit; transition: all 0.2s;
  }
  .suggest-chip:hover { border-color: rgba(255,255,255,0.2); color: #aaa; }
  .suggest-chip.added { opacity: 0.4; cursor: default; }

  /* Buttons */
  .btn-primary {
    padding: 10px 28px; border-radius: 9px; border: none; cursor: pointer;
    background: linear-gradient(135deg, #f97316, #ea580c); color: #fff;
    font-size: 14px; font-weight: 600; font-family: inherit;
    box-shadow: 0 4px 20px rgba(249,115,22,0.3); transition: transform 0.1s;
  }
  .btn-primary:active { transform: scale(0.97); }
  .btn-secondary {
    padding: 10px 18px; border-radius: 9px; cursor: pointer;
    border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.03);
    color: #999; font-size: 13px; font-family: inherit; transition: all 0.2s;
  }
  .btn-secondary:hover { border-color: rgba(255,255,255,0.15); color: #ccc; }

  /* Bottom bar */
  .bottom-bar { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; padding: 16px 0; }
  .saved-msg { font-size: 12.5px; color: #22c55e; animation: fadeIn 0.3s ease; }
  .footer { text-align: center; margin-top: 16px; font-size: 11px; color: #444; }

  /* Info box */
  .info-box {
    padding: 14px 16px; border-radius: 10px;
    background: rgba(251,146,60,0.05); border: 1px solid rgba(251,146,60,0.12);
    font-size: 12px; color: #b0885a; line-height: 1.6; margin-top: 24px;
  }
  .info-box code {
    background: rgba(255,255,255,0.06); padding: 2px 6px; border-radius: 4px; font-size: 11px;
  }

  /* Link */
  .link-btn {
    font-size: 11px; color: #888; text-decoration: none; padding: 4px 10px;
    border-radius: 6px; border: 1px solid rgba(255,255,255,0.08); transition: all 0.2s;
  }
  .link-btn:hover { border-color: rgba(255,255,255,0.15); color: #aaa; }

  .tab-content { display: none; }
  .tab-content.active { display: block; }
  .empty { display: flex; align-items: center; justify-content: center; height: 80px; color: #555; font-size: 13px; }

  @keyframes fadeIn { from { opacity: 0; transform: translateX(8px); } to { opacity: 1; transform: translateX(0); } }
</style>
</head>
<body>

<div class="container">
  <!-- Header -->
  <div class="header">
    <div class="logo">ğŸ™</div>
    <div>
      <h1>VoiceType è¨­å®šä¸­å¿ƒ</h1>
      <p>èªéŸ³è¼¸å…¥å¼•æ“ Â· å¾Œè‡ºç®¡ç†</p>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab active" data-tab="api">ğŸ”‘ API é‡‘é‘°</button>
    <button class="tab" data-tab="voice">ğŸ¤ èªéŸ³è¨­å®š</button>
    <button class="tab" data-tab="llm">âš¡ LLM ä¿®é£¾</button>
    <button class="tab" data-tab="dict">ğŸ“– è‡ªè¨‚è©å½™</button>
    <button class="tab" data-tab="general">âš™ ä¸€èˆ¬è¨­å®š</button>
  </div>

  <!-- Card -->
  <div class="card">

    <!-- â•â•â• API Keys â•â•â• -->
    <div class="tab-content active" id="tab-api">
      <h2>API é‡‘é‘°ç®¡ç†</h2>
      <p class="desc">é‡‘é‘°åƒ…å„²å­˜åœ¨æœ¬æ©Ÿè¨­å®šæª”ä¸­ï¼Œä¸æœƒå‚³é€è‡³ä»»ä½•ç¬¬ä¸‰æ–¹ä¼ºæœå™¨</p>

      <div class="section">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <div>
            <div class="section-label" style="margin:0">Groq API Key</div>
            <div class="section-desc" style="margin:0">ç”¨æ–¼ Whisper èªéŸ³è¾¨è­˜ Â· <span style="color:var(--accent)">STT æ¨è–¦</span></div>
          </div>
          <a class="link-btn" href="https://console.groq.com/keys" target="_blank">å–å¾—é‡‘é‘° â†—</a>
        </div>
        <div class="input-group">
          <input type="password" id="key-groq" placeholder="gsk_...">
          <button class="btn-icon" onclick="toggleVis('key-groq')">ğŸ‘</button>
        </div>
      </div>

      <div class="section">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <div>
            <div class="section-label" style="margin:0">OpenAI API Key</div>
            <div class="section-desc" style="margin:0">ç”¨æ–¼ Whisper / ChatGPT Â· <span style="color:var(--accent)">LLM ä¿®é£¾æ¨è–¦</span></div>
          </div>
          <a class="link-btn" href="https://platform.openai.com/api-keys" target="_blank">å–å¾—é‡‘é‘° â†—</a>
        </div>
        <div class="input-group">
          <input type="password" id="key-openai" placeholder="sk-...">
          <button class="btn-icon" onclick="toggleVis('key-openai')">ğŸ‘</button>
        </div>
      </div>

      <div class="section">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <div>
            <div class="section-label" style="margin:0">Anthropic API Key</div>
            <div class="section-desc" style="margin:0">ç”¨æ–¼ Claude æ™ºèƒ½ä¿®é£¾</div>
          </div>
          <a class="link-btn" href="https://console.anthropic.com/settings/keys" target="_blank">å–å¾—é‡‘é‘° â†—</a>
        </div>
        <div class="input-group">
          <input type="password" id="key-anthropic" placeholder="sk-ant-...">
          <button class="btn-icon" onclick="toggleVis('key-anthropic')">ğŸ‘</button>
        </div>
      </div>

      <div class="section">
        <div class="section-label">Ollama ç«¯é»</div>
        <div class="section-desc">æœ¬åœ° LLM æ¨ç†ä¼ºæœå™¨ä½å€</div>
        <div class="input-group">
          <input type="text" id="key-ollama" placeholder="http://localhost:11434">
        </div>
      </div>

      <div class="info-box">
        ğŸ”’ æ‰€æœ‰ API é‡‘é‘°å„²å­˜æ–¼æœ¬æ©Ÿ <code>%APPDATA%/voicetype/config.json</code>ï¼Œä¸æœƒä¸Šå‚³è‡³ä»»ä½•é›²ç«¯æœå‹™ã€‚
      </div>
    </div>

    <!-- â•â•â• Voice â•â•â• -->
    <div class="tab-content" id="tab-voice">
      <h2>èªéŸ³è¾¨è­˜è¨­å®š</h2>
      <p class="desc">é¸æ“‡ STT å¼•æ“èˆ‡èªéŸ³è¼¸å…¥åå¥½</p>

      <div class="section">
        <div class="section-label">è¾¨è­˜å¼•æ“</div>
        <div id="stt-providers"></div>
      </div>

      <div class="section">
        <div class="section-label">æ¨¡å‹é¸æ“‡</div>
        <div class="chips" id="stt-models"></div>
      </div>

      <div class="section">
        <div class="section-label">è¾¨è­˜èªè¨€</div>
        <div class="chips" id="languages"></div>
      </div>

      <div class="section">
        <div class="section-label">Push-to-Talk å¿«æ·éµ</div>
        <div class="section-desc">æŒ‰ä½èªªè©±ï¼Œæ”¾é–‹å¾Œè‡ªå‹•è¾¨è­˜ä¸¦è¼¸å‡º</div>
        <div class="chips" id="hotkeys"></div>
      </div>
    </div>

    <!-- â•â•â• LLM â•â•â• -->
    <div class="tab-content" id="tab-llm">
      <h2>LLM æ™ºèƒ½ä¿®é£¾</h2>
      <p class="desc">è¨­å®šç”¨æ–¼èªéŸ³å¾Œè™•ç†çš„å¤§å‹èªè¨€æ¨¡å‹</p>

      <div class="section">
        <div class="section-label">ä¿®é£¾å¼•æ“</div>
        <div id="llm-providers"></div>
      </div>

      <div class="section">
        <div class="section-label">æ¨¡å‹é¸æ“‡</div>
        <div class="chips" id="llm-models"></div>
      </div>

      <div class="section">
        <div class="section-label">ä¿®é£¾åŠŸèƒ½</div>
        <div id="llm-features"></div>
      </div>

      <div class="section">
        <div class="section-label">ç³»çµ±æç¤ºè©</div>
        <textarea id="system-prompt" rows="8"></textarea>
      </div>
    </div>

    <!-- â•â•â• Dictionary â•â•â• -->
    <div class="tab-content" id="tab-dict">
      <h2>è‡ªè¨‚è©å½™è¡¨</h2>
      <p class="desc">æ·»åŠ å°ˆæœ‰åè©ã€å“ç‰Œåå’ŒæŠ€è¡“è¡“èªï¼Œæå‡è¾¨è­˜æº–ç¢ºåº¦</p>

      <div class="dict-input">
        <input type="text" id="new-word" placeholder="è¼¸å…¥è©å½™ï¼ŒæŒ‰ Enter æ·»åŠ ...">
        <button class="btn-primary" style="padding:0 18px;font-size:13px" onclick="addWord()">+ æ·»åŠ </button>
      </div>
      <div class="dict-list" id="dict-list"></div>

      <div>
        <div style="font-size:12px;color:var(--muted);margin:12px 0 8px">å¸¸ç”¨å»ºè­°è©å½™</div>
        <div class="suggest-chips" id="suggest-chips"></div>
      </div>
    </div>

    <!-- â•â•â• General â•â•â• -->
    <div class="tab-content" id="tab-general">
      <h2>ä¸€èˆ¬è¨­å®š</h2>
      <p class="desc">ç³»çµ±è¡Œç‚ºèˆ‡è¼¸å‡ºåå¥½</p>

      <div class="section">
        <div class="section-label">æ–‡å­—è¼¸å‡ºæ–¹å¼</div>
        <div id="output-modes"></div>
      </div>
    </div>

  </div>

  <!-- Bottom Bar -->
  <div class="bottom-bar">
    <button class="btn-secondary" onclick="exportConfig()">â¬‡ åŒ¯å‡ºè¨­å®š</button>
    <div style="display:flex;gap:10px;align-items:center">
      <span class="saved-msg" id="saved-msg" style="display:none">âœ… å·²å„²å­˜</span>
      <button class="btn-primary" onclick="saveConfig()">å„²å­˜è¨­å®š</button>
    </div>
  </div>

  <div class="footer">VoiceType v0.1.0 Â· è¨­å®šæª”è·¯å¾‘ï¼š%APPDATA%/voicetype/config.json</div>
</div>

<script>
// â”€â”€ Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const API_BASE = `http://localhost:${location.port || 18923}`;

const STT_PROVIDERS = [
  { id: "groq", name: "Groq Whisper", desc: "æ¥µå¿«ã€å¹¾ä¹å…è²»", models: ["whisper-large-v3-turbo", "whisper-large-v3"] },
  { id: "openai", name: "OpenAI Whisper", desc: "é«˜å“è³ªã€ç©©å®š", models: ["whisper-1"] },
  { id: "local", name: "æœ¬åœ° Whisper", desc: "é›¢ç·šã€å…è²»", models: ["tiny", "base", "small", "medium", "large-v3"] },
];

const LLM_PROVIDERS = [
  { id: "openai", name: "OpenAI ChatGPT", desc: "æ™ºèƒ½ä¿®é£¾é¦–é¸ï¼Œç©©å®šå¯é ", models: ["gpt-4o-mini", "gpt-4o", "gpt-4.1-mini", "gpt-4.1-nano"] },
  { id: "anthropic", name: "Anthropic Claude", desc: "é«˜å“è³ªæ–‡å­—è™•ç†", models: ["claude-haiku-4-5-20251001", "claude-sonnet-4-5-20250929"] },
  { id: "groq", name: "Groq (é–‹æºæ¨¡å‹)", desc: "æ¥µå¿«æ¨ç†", models: ["llama-3.3-70b-versatile", "gemma2-9b-it"] },
  { id: "ollama", name: "Ollama æœ¬åœ°", desc: "å®Œå…¨é›¢ç·š", models: ["qwen3:8b", "gemma3:4b", "llama3.2:3b"] },
];

const HOTKEYS = [
  { id: "RightAlt", label: "Right Alt" }, { id: "RightCtrl", label: "Right Ctrl" },
  { id: "F9", label: "F9" }, { id: "CapsLock", label: "CapsLock" }, { id: "ScrollLock", label: "Scroll Lock" },
];

const LANGUAGES = [
  { id: "auto", label: "ğŸŒ è‡ªå‹•åµæ¸¬" }, { id: "zh-TW", label: "ğŸ‡¹ğŸ‡¼ ç¹é«”ä¸­æ–‡" },
  { id: "zh-CN", label: "ğŸ‡¨ğŸ‡³ ç°¡é«”ä¸­æ–‡" }, { id: "en", label: "ğŸ‡ºğŸ‡¸ English" }, { id: "ja", label: "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª" },
];

const SUGGEST_WORDS = ["BNI", "n8n", "Activepieces", "LINE", "RAG", "Whisper", "Claude", "Blender", "Unity"];

const OUTPUT_MODES = [
  { id: "clipboard", name: "å‰ªè²¼ç°¿ + è²¼ä¸Š", desc: "è¤‡è£½åˆ°å‰ªè²¼ç°¿å¾Œæ¨¡æ“¬ Ctrl+Vï¼ˆæ¨è–¦ï¼Œæ”¯æ´ä¸­æ–‡ï¼‰" },
  { id: "keyboard", name: "æ¨¡æ“¬éµç›¤è¼¸å…¥", desc: "é€å­—æ¨¡æ“¬æŒ‰éµè¼¸å…¥ï¼ˆåƒ…æ”¯æ´è‹±æ–‡å­—å…ƒï¼‰" },
];

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let config = {};

// â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function init() {
  try {
    const res = await fetch(`${API_BASE}/api/config`);
    config = await res.json();
  } catch {
    // é›¢ç·šæ¨¡å¼ï¼šä½¿ç”¨é è¨­å€¼
    config = {
      sttProvider: "groq", llmProvider: "openai",
      sttModel: "whisper-large-v3-turbo", llmModel: "gpt-4o-mini",
      apiKeys: { groq: "", openai: "", anthropic: "", ollama: "http://localhost:11434" },
      hotkey: "RightAlt", language: "auto", outputMode: "clipboard",
      removeFiller: true, autoFormat: true, contextAware: true,
      dictionary: [], systemPrompt: "",
    };
  }
  render();
}

// â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function render() {
  // API Keys
  document.getElementById("key-groq").value = config.apiKeys?.groq || "";
  document.getElementById("key-openai").value = config.apiKeys?.openai || "";
  document.getElementById("key-anthropic").value = config.apiKeys?.anthropic || "";
  document.getElementById("key-ollama").value = config.apiKeys?.ollama || "http://localhost:11434";

  // STT Providers
  renderProviders("stt-providers", STT_PROVIDERS, config.sttProvider, (id) => {
    config.sttProvider = id;
    config.sttModel = STT_PROVIDERS.find(p => p.id === id).models[0];
    render();
  });

  // STT Models
  const sttP = STT_PROVIDERS.find(p => p.id === config.sttProvider);
  renderChips("stt-models", sttP?.models || [], config.sttModel, (m) => { config.sttModel = m; render(); });

  // Languages
  renderChips("languages", LANGUAGES.map(l => l.label), LANGUAGES.find(l => l.id === config.language)?.label,
    (label) => { config.language = LANGUAGES.find(l => l.label === label).id; render(); });

  // Hotkeys
  renderChips("hotkeys", HOTKEYS.map(h => h.label), HOTKEYS.find(h => h.id === config.hotkey)?.label,
    (label) => { config.hotkey = HOTKEYS.find(h => h.label === label).id; render(); });

  // LLM Providers
  renderProviders("llm-providers", LLM_PROVIDERS, config.llmProvider, (id) => {
    config.llmProvider = id;
    config.llmModel = LLM_PROVIDERS.find(p => p.id === id).models[0];
    render();
  });

  // LLM Models
  const llmP = LLM_PROVIDERS.find(p => p.id === config.llmProvider);
  renderChips("llm-models", llmP?.models || [], config.llmModel, (m) => { config.llmModel = m; render(); });

  // LLM Features
  renderFeatures();

  // System prompt
  document.getElementById("system-prompt").value = config.systemPrompt || "";

  // Dictionary
  renderDictionary();

  // Output modes
  renderProviders("output-modes", OUTPUT_MODES, config.outputMode, (id) => { config.outputMode = id; render(); });
}

function renderProviders(containerId, providers, activeId, onClick) {
  const el = document.getElementById(containerId);
  el.innerHTML = providers.map(p => `
    <div class="provider-card ${p.id === activeId ? 'active' : ''}" onclick="(${onClick})(\'${p.id}\')">
      <div><div class="name">${p.name}</div><div class="pdesc">${p.desc}</div></div>
      ${p.id === activeId ? '<div class="check">âœ“</div>' : ''}
    </div>
  `).join("");
  // Re-bind clicks properly
  el.querySelectorAll('.provider-card').forEach((card, i) => {
    card.onclick = () => onClick(providers[i].id);
  });
}

function renderChips(containerId, items, activeItem, onClick) {
  const el = document.getElementById(containerId);
  el.innerHTML = items.map(item => `
    <button class="chip ${item === activeItem ? 'active' : ''}">${item}</button>
  `).join("");
  el.querySelectorAll('.chip').forEach((chip, i) => {
    chip.onclick = () => onClick(items[i]);
  });
}

function renderFeatures() {
  const features = [
    { key: "autoStart", label: "éš¨ Windows å•Ÿå‹•", desc: "ç³»çµ±é–‹æ©Ÿæ™‚è‡ªå‹•å•Ÿå‹• VoiceType" },
    { key: "removeFiller", label: "å»é™¤å£é ­ç¦ª", desc: "ç§»é™¤ã€Œå—¯ã€ã€Œå•Šã€ã€Œé‚£å€‹ã€ç­‰è´…å­—" },
    { key: "autoFormat", label: "è‡ªå‹•æ ¼å¼åŒ–", desc: "åˆ—è¡¨ã€æ­¥é©Ÿè‡ªå‹•çµæ§‹åŒ–" },
    { key: "contextAware", label: "èªå¢ƒé©æ‡‰", desc: "æ ¹æ“šç•¶å‰ App è‡ªå‹•èª¿æ•´èªæ°£" },
  ];
  const el = document.getElementById("llm-features");
  el.innerHTML = features.map(f => `
    <div class="toggle-row">
      <div><div class="label">${f.label}</div><div class="tdesc">${f.desc}</div></div>
      <button class="toggle ${config[f.key] ? 'on' : 'off'}" data-key="${f.key}">
        <div class="dot"></div>
      </button>
    </div>
  `).join("");
  el.querySelectorAll('.toggle').forEach(btn => {
    btn.onclick = () => {
      const key = btn.dataset.key;
      config[key] = !config[key];
      render();
    };
  });
}

function renderDictionary() {
  const list = document.getElementById("dict-list");
  const dict = config.dictionary || [];
  if (dict.length === 0) {
    list.innerHTML = '<div class="empty">å°šæœªæ·»åŠ ä»»ä½•è©å½™</div>';
  } else {
    list.innerHTML = dict.map(w => `
      <div class="word-tag">${w}<button class="remove" data-word="${w}">âœ•</button></div>
    `).join("");
    list.querySelectorAll('.remove').forEach(btn => {
      btn.onclick = () => { removeWord(btn.dataset.word); };
    });
  }

  // Suggest chips
  const suggest = document.getElementById("suggest-chips");
  suggest.innerHTML = SUGGEST_WORDS.map(w => `
    <button class="suggest-chip ${dict.includes(w) ? 'added' : ''}" ${dict.includes(w) ? 'disabled' : ''}>+ ${w}</button>
  `).join("");
  suggest.querySelectorAll('.suggest-chip:not(.added)').forEach((btn, i) => {
    btn.onclick = () => {
      const w = SUGGEST_WORDS.filter(w => !dict.includes(w))[i];
      if (w) addWordDirect(w);
    };
  });
}

// â”€â”€ Actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleVis(id) {
  const input = document.getElementById(id);
  input.type = input.type === "password" ? "text" : "password";
}

function addWord() {
  const input = document.getElementById("new-word");
  const w = input.value.trim();
  if (w && !(config.dictionary || []).includes(w)) {
    if (!config.dictionary) config.dictionary = [];
    config.dictionary.push(w);
    input.value = "";
    render();
  }
  input.focus();
}

function addWordDirect(w) {
  if (!config.dictionary) config.dictionary = [];
  if (!config.dictionary.includes(w)) {
    config.dictionary.push(w);
    render();
  }
}

function removeWord(w) {
  config.dictionary = (config.dictionary || []).filter(x => x !== w);
  render();
}

// Enter to add word
document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("new-word")?.addEventListener("keydown", e => {
    if (e.key === "Enter") addWord();
  });
});

async function saveConfig() {
  // Collect API keys from inputs
  config.apiKeys = {
    groq: document.getElementById("key-groq").value,
    openai: document.getElementById("key-openai").value,
    anthropic: document.getElementById("key-anthropic").value,
    ollama: document.getElementById("key-ollama").value,
  };
  config.systemPrompt = document.getElementById("system-prompt").value;

  try {
    await fetch(`${API_BASE}/api/config`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(config),
    });
  } catch {
    // é›¢ç·šæ¨¡å¼
  }

  const msg = document.getElementById("saved-msg");
  msg.style.display = "inline";
  setTimeout(() => msg.style.display = "none", 2000);
}

function exportConfig() {
  config.apiKeys = {
    groq: document.getElementById("key-groq").value,
    openai: document.getElementById("key-openai").value,
    anthropic: document.getElementById("key-anthropic").value,
    ollama: document.getElementById("key-ollama").value,
  };
  config.systemPrompt = document.getElementById("system-prompt").value;

  const blob = new Blob([JSON.stringify(config, null, 2)], { type: "application/json" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "voicetype-config.json";
  a.click();
}

// â”€â”€ Tab switching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.querySelectorAll(".tab").forEach(tab => {
  tab.onclick = () => {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.querySelectorAll(".tab-content").forEach(t => t.classList.remove("active"));
    tab.classList.add("active");
    document.getElementById(`tab-${tab.dataset.tab}`).classList.add("active");
  };
});

// â”€â”€ Start â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
init();
</script>
</body>
</html>
